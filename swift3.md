# Migration from Swift 2.3 to 3.0

I've read several articles on migrating to Swift 3 which are all quite good, but this is my story.  I started my iOS development back in January of 2016 and right around October everything turned upside down with the release of Swift 3.  Since I was furiously trying to get features into my app so I could go live on the App Store, I had put migration in the backlog for some time with a lower priority, if it ain't broke then don't fix it, right?  It wasn't until I wanted to leverage some external libraries that I decided Swift 2.3 was holding me back so it was time to upgrade--I'm looking at you openears!  I seem to remember that you can install different Swift compiler versions and reference it by changing symlinks or something, but I didn't want to hack up my development environment so the only way was to first upgrade Xcode 7.3 to 8.  Fortunately I have multiple Macs and can install different versions of Xcode to play around with, but my first experience with Xcode 8 after you open up a workspace/project is that you get this annoying popup dialogue asking if you want to convert your code to Swift 3, there is an option to do this **later**, but if you click this, there's a follow on popup that asks if you're sure you want to do this later and reverses the order of the **later** and **convert** buttons, it's almost like those free porn sites where they have these almost real looking hyperlinks upon first look, but when you click on them, they end up opening 50 tabs on your browser to obscure places on the web, and then you notice the actual link a little bit further down the page, completely dishonest, but there's no material gain for Apple seemingly for this, they must really want developers to convert to Swift 3 and to do it quickly!  Prompting for conversion immediately smelled to me of some interface incompatibility issues with Swift 2.3, yes, I'm one of those people that never read the manual and dive directly in, on the one hand it's nice that Apple's created a tool to help with migration, but that just scares the living bejesus out of me, holy sweet baby jesus, I need a tool to get me through this!  Another ensuing dialogue pops up if you click **convert** asking which frameworks to include in the conversion.  For the record, I have been using Cocoapods and rely on quite a few external libraries:  https://github.com/alamofire/alamofire, Crypto, Font-Awesome-Swift, KeychainSwift, Kingfisher, SwiftyJSON, and SwiftWebSocket.  By default, all of your pods are included and checked for conversion.  I typically take the defaults if I'm new to something, it's like when you're reading Charles Dickens for the first time, say The Great Expectations, and you find yourself checking the dictionary every 10 words to the point where you're fed up and then you realize that if you had only skipped ahead, you'd probably get much more context from the next 20 words and could take a pretty darn good guess at what the word means, the same applies here, no need to go knee deep if it's unnecessary, there are plenty of other things to learn, it'll all start to fall in place over time.  But taking the defaults ends up giving you a huge list of files that need conversion, including some of the external library source files.  So if you go to the migration guide for Swift 3, it suggests that you either wait for the author to make their library Swift 3 compliant, or you include their sources in your project as a sub-module and do the conversion for them, hell no, not in a million years, I'm not going to maintain that code base for any amount of time, not fond of upstream merges when I don't have the time!  For all of my external library dependencies, I noticed that they had mostly migrated to Swift 3 either stated explicitly on their website or through my sniffing around in their github issues, but the fact that the migration tool was telling me that they had all this incorrect syntax in their library really caused me to be doubtful.

So that first experience caused me to give up and go back to adding features to my app instead.  But over the Christmas Holidays, I decided that it was time to bite the bullet and take care of this technical debt so that I could run full speed in 2017!  For some reason, I looked at all the github pages again for my external dependencies and all the github issues searching for Swift 3 and they all confirmed that they mostly had support for this, which cleared some of my doubts, so I tried again.  And again, the popup with all the frameworks checked by default showed up again and this time, what's typically my last resort, it was trial and error time, I decided to uncheck all the external libraries because they _should_ all be Swift 3 compatible, I was seeing some glaring 2.3 code from the conversion diff output, it was like the source code was cached somewhere for an older version that wasn't Swift 3 compatible (I deleted my Pods directory several times to make certain that I had the latest external depedency sources).  Low and behold that worked like a charm, what I was left with was the mess of code from my own source tree that needed to be converted to Swift 3 compatible syntax, rock on!

Most of my code conversions were changes to names of functions, like Alamofire, for instance, used to call something like this to get a singleton of the Alamofire instance:

`let web = Alamofire.Manager.session`

And this is the new code under Swift 3

`let web = Alamofire.SessionManager.sharedInstance`

Not entirely intuitive, but easy to fix with a find/replace.  The next type of conversions that seemed frequent were for things like requiring a key for each parameter passed into a function, it used to be that you could omit the very first parameter key, but Swift 3 does not like this very much, in fact it hates it and will hate you and never let you compile the code successfully in a million years or until you fix it!

I also ran into several issues where a class lowercased its enum list like for UIAlertActionStyle and UIAlertControllerStyle, but those were trivial.

I went through this motion for about 2 hours, Alamofire was the most widely used external library and they had changed the way they handle responses that do not include data, this tripped me up a little bit at first, but most everything else was simple.  One thing of note to point out is that the compilation errors which ranged in the triple digits, only showed something like 10 at a time, after I fixed those, Xcode would give me the next 10 or so, I didn't explicitly count, but I really think it was around 10 or so, why Xcode just didn't give me the 100 or so errors all at once, I do not know, it seems like one of those glass half full things, so fine, whatever, don't have the time to figure that out, just move on.  Eventually the compiler was happy, save for those hundred or so warnings from my storyboard regarding `Frame for "Stack View" will be different at run time.`.  There were some other subtle errors that I did have to clean up as a result of the conversion, but where I was initializing some associative array like such:

```
let game = [String: String]()

return game["id": self.data[indexPath.items][0], "name": self.data[indexPath.items][1]]
```

The error was along the lines of this operation taking too long to complete, suggesting that I find another way.
